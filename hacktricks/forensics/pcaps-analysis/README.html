<h1 id="Pcaps-analysis"><a href="#Pcaps-analysis" class="headerlink" title="Pcaps analysis"></a>Pcaps analysis</h1><p>Start <strong>searching</strong> for <strong>malware</strong> inside the pcap. Use the <strong>tools</strong> mentioned in <a href="../malware-analysis.md"><strong>Malware Analysis</strong></a>.</p>
<p>A note about PCAP vs PCAPNG: there are two versions of the PCAP file format; PCAPNG is newer and not supported by all tools. You may need to convert a file from PCAPNG to PCAP using Wireshark or another compatible tool, in order to work with it in some other tools.</p>
<h2 id="Online-tools-for-pcaps"><a href="#Online-tools-for-pcaps" class="headerlink" title="Online tools for pcaps"></a>Online tools for pcaps</h2><ul>
<li>If the header of your pcap is <strong>broken</strong> you should try to <strong>fix</strong> it using: <a href="http://f00l.de/hacking/pcapfix.php" target="_blank" rel="noopener">http://f00l.de/hacking/<strong>pcapfix.php</strong></a>****</li>
<li>Extract <strong>information</strong> and search for <strong>malware</strong> inside a pcap in <a href="https://packettotal.com/" target="_blank" rel="noopener"><strong>PacketTotal</strong></a>****</li>
</ul>
<h2 id="Basic-Statistics"><a href="#Basic-Statistics" class="headerlink" title="Basic Statistics"></a>Basic Statistics</h2><h3 id="Capinfos"><a href="#Capinfos" class="headerlink" title="Capinfos"></a>Capinfos</h3><pre><code class="text">capinfos capture.pcap
</code></pre>
<h3 id="Wireshark"><a href="#Wireshark" class="headerlink" title="Wireshark"></a>Wireshark</h3><p>Inside wireshark you can see different <strong>statistics</strong> that could be useful. Some interesting http filters: <a href="https://www.wireshark.org/docs/dfref/h/http.html" target="_blank" rel="noopener">https://www.wireshark.org/docs/dfref/h/http.html</a></p>
<p>If you want to <strong>search</strong> for <strong>content</strong> inside the <strong>packets</strong> of the sessions press <em>CTRL+f</em><br>You can add new layers to the main information bar <em>(No., Time, Sourceâ€¦)</em> pressing <em>right bottom</em> and <em>Edit Column</em></p>
<p><a href="wireshark-tricks.md">Some WireShark tricks here.</a></p>
<h2 id="Suricata"><a href="#Suricata" class="headerlink" title="Suricata"></a>Suricata</h2><h3 id="Install-and-setup"><a href="#Install-and-setup" class="headerlink" title="Install and setup"></a>Install and setup</h3><pre><code class="text">apt-get install suricata
apt-get install oinkmaster
echo &quot;url = http://rules.emergingthreats.net/open/suricata/emerging.rules.tar.gz&quot; &gt;&gt; /etc/oinkmaster.conf
oinkmaster -C /etc/oinkmaster.conf -o /etc/suricata/rules
</code></pre>
<h3 id="Check-pcap"><a href="#Check-pcap" class="headerlink" title="Check pcap"></a>Check pcap</h3><pre><code class="text">suricata -r packets.pcap -c /etc/suricata/suricata.yaml -k none -v -l log
</code></pre>
<h2 id="Ngrep"><a href="#Ngrep" class="headerlink" title="Ngrep"></a>Ngrep</h2><p>If you are <strong>looking</strong> for <strong>something</strong> inside the pcap you can use <strong>ngrep</strong>. And example using the main filters:</p>
<pre><code class="text">ngrep -I packets.pcap &quot;^GET&quot; &quot;port 80 and tcp and host 192.168 and dst host 192.168 and src host 192.168&quot;
</code></pre>
<h2 id="Xplico-Framework"><a href="#Xplico-Framework" class="headerlink" title="Xplico Framework"></a>Xplico Framework</h2><p>Xplico can <strong>analyze</strong> a <strong>pcap</strong> and extract information from it. For example, from a pcap file Xplico extracts each email (POP, IMAP, and SMTP protocols), all HTTP contents, each VoIP call (SIP), FTP, TFTP, and so on.</p>
<h3 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h3><pre><code class="text">sudo bash -c &#39;echo &quot;deb http://repo.xplico.org/ $(lsb_release -s -c) main&quot; /etc/apt/sources.list&#39;
sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 791C25CE
sudo apt-get update
sudo apt-get install xplico
</code></pre>
<h3 id="Run"><a href="#Run" class="headerlink" title="Run"></a>Run</h3><pre><code class="text">/etc/init.d/apache2 restart
/etc/init.d/xplico start
</code></pre>
<p>Access to <em><strong>127.0.0.1:9876</strong>_ with credentials _<strong>xplico:xplico</strong></em></p>
<p>Then create a <strong>new case</strong>, create a <strong>new session</strong> inside the case and <strong>upload the pcap</strong> file.</p>
<h2 id="NetworkMiner"><a href="#NetworkMiner" class="headerlink" title="NetworkMiner"></a>NetworkMiner</h2><p>Like Xplico it is a tool to analyze and extract objects from pcaps. It has a free edition that you can download <a href="https://www.netresec.com/?page=NetworkMiner" target="_blank" rel="noopener">here</a>.</p>
<h2 id="Other-pcap-analysis-tricks"><a href="#Other-pcap-analysis-tricks" class="headerlink" title="Other pcap analysis tricks"></a>Other pcap analysis tricks</h2><ul>
<li><a href="dnscat-exfiltration.md">DNSCat pcap analysis</a></li>
<li><a href="usb-keyboard-pcap-analysis.md">USB Keyboard pcap analysis</a></li>
</ul>
